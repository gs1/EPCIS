openapi: "3.0.3"
info:
  version: 2.0.0
  title: EPCIS 2.0 REST Bindings
  license:
    name: Apache2

tags:
  - name: 'Top-level'
    description: |
      Endpoints to browse or retrieve information about EPCIS resources:
      - events
      - types of events
      - electronic product codes
      - business steps
      - business locations
      - read points
      - dispositions
  - name: 'Events'
    description: |
      Endpoints that allow you to retrieve EPCIS events as Web resources.
  - name: 'Capture'
    description: |
      Endpoints to capture EPCIS events in bulk or individually.
  - name: 'Queries'
    description: |
      Endpoints to create large named or anonymous queries using the <a href="https://github.com/gs1/EPCIS/tree/master/REST%20Bindings/query-schema.json">EPCIS Query Language</a>. Named queries have a custom
      name and are stored until deleted by the user. Anonymous queries are not persisted and only available to the caller.
      EPCIS events queries also support query subscription.
  - name: 'Subscriptions'
    description: |
      EPCIS 2.0 supports query subscriptions using Webhooks or Websockets.
  - name: 'Discovery'
    description: |
      Endpoints to obtain information about the endpoint, such as EPCIS and CBV versions or custom vocabularies.

paths:
  /:
    options:
      tags:
        - 'Discovery'
      summary: Query server settings, EPCIS version(s) and related vocabularies/standards.
      description: |
        `OPTIONS` on the root path gives the client an overview of the server's EPCIS-related configurations.
      responses:
        '204':
          $ref: '#/components/responses/204DefaultDiscoveryResponse'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Discovery'
      summary: Returns the list of top level resources available for this EPCIS repository.
      parameters:
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-Extensions'
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
        - $ref: '#/components/parameters/GS1-CBV-Version'
      description: |
        This endpoint returns all the top-level resources currently available in the repository.
      responses:
        '200':
          $ref: '#/components/responses/200SupportedTopLevel'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

    

  /capture:
    parameters:
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Discover the settings of the capture interface.
      description: |
        The `OPTIONS` method is used as a discovery service for `/capture`. It describes

        - which EPCIS and CBV versions are supported,
        - the EPCIS and CBV extensions,
        - the maximum payload size as count of EPCIS events (`GS1-EPCIS-Capture-Limit` header) or as a maximum payload size in bytes (`GS1-EPCIS-Capture-File-Size-Limit` header)
        - what the server will do if an error occurred during capture (`GS1-Capture-Error-Behaviour` header).

        The list of headers is not exhaustive. It only describes the functionality specific to EPCIS 2.0.
      responses:
        '204':
          $ref: '#/components/responses/204CaptureEndpointDiscovery'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    post:
      tags:
        - 'Capture'
      summary: Asynchronous capture endpoint for one or more EPCIS events. 
      
      parameters:
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-EPC-Format'
        - $ref: '#/components/parameters/GS1-CBV-XML-Format'
        - $ref: '#/components/parameters/GS1-Capture-Error-Behaviour'

      description: |
        EPCIS events are added in bulk using the capture interface. Four design considerations were made to remain compatible with EPCIS 1.2:

        - EPCIS 2.0 keeps event IDs optional. If event IDs are missing, the server should populate the event id with a unique value.
        Otherwise, it won't be possible to retrieve these events by eventID.
        - By default, EPCIS events are only stored if the entire capture job was successful. This behaviour can be changed with the `GS1-Capture-Error-Behaviour` header.
        - EPCIS master data can be captured in the header (`epcisHeader`) of an `EPCISDocument`.
        - This endpoint should support both `EPCISDocument` and `EPCISQueryDocument` as input.

        To prevent timeouts for large payloads, the client potentially may need to split the payload into several capture calls. To that end, the server can specify a capture
        limit (number of EPCIS events) and file size limit (payload size).

        A successful capturing of events does not guarantee that events will be stored. Instead, the server returns a
        capture id, which the client can use to obtain information about the capture job.

      requestBody:
        required: true
        content:
          application/json:
            schema:
                    oneOf:
                      - $ref: '#/components/schemas/EPCISQueryDocument'
                      - $ref: '#/components/schemas/EPCISDocument'      
      responses:
        '202':
          description: |
            Successfully received one or more EPCIS events. The request returns a unique
            capture job URL in the Location header.
          headers:
            GS1-EPCIS-Version:
              $ref: '#/components/headers/GS1-EPCIS-Version'
            GS1-CBV-Version:
              $ref: '#/components/headers/GS1-CBV-Version'
            GS1-EPC-Format:
              $ref: '#/components/headers/GS1-EPC-Format'
            GS1-CBV-XML-Format:
              $ref: '#/components/headers/GS1-CBV-XML-Format'
            GS1-Extensions:
              $ref: '#/components/headers/GS1-Extensions'
            Location:
              example: "https://example.com/capture/id9261379075"
              schema:
                $ref: '#/components/schemas/Location'

        '400':
          description: |
            An error occurred while receiving EPCIS events. All events are rejected. This is not to be confused with
            an error while capturing EPCIS events. To monitor the capture job, use the `/capture/{captureID}` endpoint.
          content:
            application/problem+json:
              schema:
                allOf:
                  - properties:
                      status:
                        type: integer
                        enum:
                          - 400
                        default: 400
                      type:
                        type: string
                        format: uri
                        enum:
                          - epcisException:ValidationException
                  - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '413':
          $ref: '#/components/responses/413CapturePayloadTooLarge'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '415':
          $ref: '#/components/responses/415UnsupportedMediaType'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Capture'
      parameters:
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-Extensions'
      summary: Returns a list of capture jobs.
      description: |
        An endpoint to list capture jobs.
        This endpoint supports pagination.
      responses:
        '200':
          headers:
            GS1-EPCIS-Version:
              $ref: '#/components/headers/GS1-EPCIS-Version'
            GS1-Extensions:
              $ref: '#/components/headers/GS1-Extensions'
            Link:
              $ref: '#/components/headers/Link'
            GS1-Next-Page-Token-Expires:
              $ref: '#/components/headers/GS1-Next-Page-Token-Expires'
          description: |
            When EPCIS events are added through the capture interface, the capture process can run asynchronously.
            A capture job resource exposes the state of the capture job to the client. This endpoint returns all
            capture jobs that were created.
          content:
            application/json:
              example: [
                {
                  "captureID": "id261378658356",
                  "createdAt": "2021-07-21T17:32:28Z",
                  "running": false,
                  "success": true,
                  "errors": [ ]
                },
                {
                  "captureID": "id9261379075",
                  "createdAt": "2021-08-21T17:32:28Z",
                  "running": true,
                  "success": true,
                  "errors": [ ]
                }]
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CaptureJob'
                uniqueItems: true
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
  /capture/{captureID}:
    parameters:
      - in: path
        name: captureID
        example: id9261379075
        description: A unique value identifying a capture job generated by the server.
        required: true
        schema:
          type: string
      - $ref: '#/components/parameters/GS1-Extensions' 
    options:
      tags:
        - 'Discovery'
      summary: Query the metadata of the capture job endpoint.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used for a given capture job.
      responses:
        '204':
          $ref: '#/components/responses/204DefaultDiscoveryResponse'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      parameters:
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
      tags:
        - 'Capture'
      summary: Returns information about the capture job.

      description: |

        When EPCIS events are added through the capture interface, the capture process can run asynchronously. If the payload
        is syntactically correct and the client is allowed to call `/capture`, the server returns a `202` HTTP response code. This
        does not guarantee successful storage of all EPCIS events. The capture job endpoint exposes the state
        of the capture job to the client.

        A capture job document has at least the following properties:

        - `running`: whether or not the capture job is still active
        - `success`: whether or not at least one error occurred,
        - `errors` or `errorFile`: with the errors if `success` is `false`.

        ### GS1-Capture-Error-Behaviour header value is `rollback`

        | Capture job `running` | Capture job `success` | Capture job outcome |
        |:--------|:---------|:---------|
        | `true` | `true` | Still capturing EPCIS events. No errors occurred so far. |
        | `true` | `false` | At least one error occurred. Rollback is in progress. |
        | `false` | `true` | All EPCIS events are captured. |
        | `false` | `false` | All EPCIS events are rejected. |

        ### GS1-Capture-Error-Behaviour header value is `proceed`

        | Capture job `running` | Capture job `success` | Capture job outcome |
        |:--------|:---------|:---------|
        | `true` | `true` | Still capturing EPCIS events. No errors occurred so far. |
        | `true` | `false` | At least one error occurred but more EPCIS events are currently being captured. |
        | `false` | `true` | All EPCIS events were captured without an error. |
        | `false` | `false` | Some EPCIS events were captured but errors occurred. |

        If `success` is `false`, check the `errors` or `errorFile` property for details.
      responses:
        '200':
          headers:
            GS1-EPCIS-Version:
              $ref: '#/components/headers/GS1-EPCIS-Version'
            GS1-Extensions:
              $ref: '#/components/headers/GS1-Extensions'
            GS1-Capture-Error-Behaviour:
              $ref: '#/components/headers/GS1-Capture-Error-Behaviour'
          description: |
            Returns the state of the capture job.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CaptureJob'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
  /events:
    parameters:
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Query metadata for the EPCIS events endpoint.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204WritableResourcesDiscovery'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '414':
          $ref: '#/components/responses/414URLTooLong'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Top-level'
        - 'Events'
      summary: Returns all EPCIS events available in the EPCIS repository.
      parameters:
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-CBV-Min'
        - $ref: '#/components/parameters/GS1-CBV-Max'
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
        - $ref: '#/components/parameters/GS1-EPC-Format'
        - $ref: '#/components/parameters/GS1-CBV-XML-Format'
      description: |
        This endpoint allows querying EPCIS events that are currently in the repository. 
        Events can be filtered through URL query string parameters as specified by the <a href="https://github.com/gs1/EPCIS/tree/master/REST%20Bindings/query-schema.json">EPCIS Query Language</a>.
      responses:
        '200':
          $ref: '#/components/responses/200EPCISQueryDocument'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '414':
          $ref: '#/components/responses/414URLTooLong'
        '500':
          $ref: '#/components/responses/500ImplementationException'

    post:
      parameters:
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-EPC-Format'
        - $ref: '#/components/parameters/GS1-CBV-XML-Format'
      tags:
        - 'Capture'
      summary: Synchronous capture interface for a single EPCIS event.
      description: |
        An individual EPCIS event can be created by making a `POST` request on the `/events` resource. Alternatively, the client can also use the `/capture`
        interface and capture a single event.
      requestBody:
        required: true
        description: A single EPCIS event with optional JSON-LD context.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SingleEvent'

      responses:
        '201':
          description: |
            Successfully created (captured) the EPCIS event. The request returns the URL of newly created
            EPCIS event in the Location header.
          headers:
            GS1-EPCIS-Version:
              $ref: '#/components/headers/GS1-EPCIS-Version'
            GS1-CBV-Version:
              $ref: '#/components/headers/GS1-CBV-Version'
            GS1-EPC-Format:
              $ref: '#/components/headers/GS1-EPC-Format'
            GS1-CBV-XML-Format:
              $ref: '#/components/headers/GS1-CBV-XML-Format'
            GS1-Extensions:
              $ref: '#/components/headers/GS1-Extensions'
            Location:
              example: "https://example.com/eventTypes/ObjectEvent/events/eventId123"
              schema:
                $ref: '#/components/schemas/Location'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SingleEvent'
        '400':
          description: An error occurred while creating the EPCIS event. The event was rejected.
          content:
            application/problem+json:
              schema:
                allOf:
                  - properties:
                      status:
                        type: integer
                        enum:
                          - 400
                        default: 400
                      type:
                        type: string
                        format: uri
                        enum:
                          - epcisException:ValidationException
                  - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '413':
          $ref: '#/components/responses/413CapturePayloadTooLarge'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '415':
          $ref: '#/components/responses/415UnsupportedMediaType'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /events/{eventID}:
    parameters:
      - $ref: '#/components/parameters/EventID'
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Query metadata for the endpoint to access an individual EPCIS event.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204DefaultDiscoveryResponse'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
          
    get:
      tags:
        - 'Events'
      summary: Returns an individual EPCIS event.
      parameters:
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-CBV-Min'
        - $ref: '#/components/parameters/GS1-CBV-Max'
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
        - $ref: '#/components/parameters/GS1-EPC-Format'
        - $ref: '#/components/parameters/GS1-CBV-XML-Format'
      description: |
        This endpoint accesses individual events using their unique identifier. The response body is an `EPCISQueryDocument` 
        enclosing the unique event and error declarations.
      responses:
        '200':
          $ref: '#/components/responses/200EPCISQueryDocumentSinglePage'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /eventTypes:
    parameters:
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Query metadata for the EPCIS event types endpoint.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204DefaultDiscoveryResponse'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Top-level'
        - 'Discovery'
      summary: Returns all EPCIS event types currently available in the EPCIS repository.
      parameters:
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-Extensions'
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-CBV-Min'
        - $ref: '#/components/parameters/GS1-CBV-Max'
      description: |
        EPCIS event types specify the schema of an event. This endpoint returns all EPCIS event types that are
        currently present in the repository.
      responses:
        '200':
          $ref: '#/components/responses/200SupportedEventTypes'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /eventTypes/{eventType}:
    parameters:
      - $ref: '#/components/parameters/EventType'
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Query metadata of the EPCIS event type endpoint.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204DefaultDiscoveryResponse'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Top-level'
      summary: Returns all sub-resources of an EPCIS event type.
      description: |
        This endpoint returns all sub-resources of an EPCIS event type, which currently is `events`. A server may
        add additional endpoints, for example `schema` to access the EPCIS event type schema.
      parameters:
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-CBV-Min'
        - $ref: '#/components/parameters/GS1-CBV-Max'
      responses:
        '200':
          $ref: '#/components/responses/200TopLevelOrEventTypeSubResource'
        '400':
          $ref: '#/components/responses/400QueryIssues'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /eventTypes/{eventType}/events:
    parameters:
      - $ref: '#/components/parameters/EventType'
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Query the metadata of the endpoint to access EPCIS events by event type.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204EventsEndpointDiscovery'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '414':
          $ref: '#/components/responses/414URLTooLong'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Events'
      summary: |
        Returns EPCIS events of a given an EPCIS event type.
      parameters:
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-CBV-Min'
        - $ref: '#/components/parameters/GS1-CBV-Max'
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
        - $ref: '#/components/parameters/GS1-EPC-Format'
        - $ref: '#/components/parameters/GS1-CBV-XML-Format'
      description: |
        This endpoint returns all EPCIS events of a specific EPCIS event type up to the amount defined in `perPage`.
        The server returns a 'Link' header to point to the remaining results.

        The client can further restrict the list of events returned by filtering events using the EPCIS query
        language using URL query string parameters as specified by the<a href="https://github.com/gs1/EPCIS/tree/master/REST%20Bindings/query-schema.json">EPCIS Query Language</a>.  
        The parameter `eventCountLimit` is used to restrict the maximum number of
        events to be returned in total, whereas `perPage` restricts the number of events to return per page or paginated results.


        Example:

        ```
        https://example.com/eventTypes/ObjectEvent/events?EQ_bizStep=shipping%7Cdecommissioning&GE_eventTime=2015-03-15T00%3A00%3A00.000-04%3A00
        ```
      responses:
        '200':
          $ref: '#/components/responses/200EPCISQueryDocument'
        '400':
          $ref: '#/components/responses/400QueryIssues'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '414':
          $ref: '#/components/responses/414URLTooLong'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /epcs:
    parameters:
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Query metadata related to the electronic product codes endpoint.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204DefaultDiscoveryResponse'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Top-level'
      parameters:
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-CBV-Min'
        - $ref: '#/components/parameters/GS1-CBV-Max'
        - $ref: '#/components/parameters/GS1-EPC-Format'
      summary: Returns known electronic product codes.
      description: |
        An endpoint to list electronic product codes.
        This endpoint supports pagination.
      responses:
        '200':
          headers:
            GS1-EPCIS-Version:
              $ref: '#/components/headers/GS1-EPCIS-Version'
            GS1-CBV-Version:
              $ref: '#/components/headers/GS1-CBV-Version'
            GS1-EPC-Format:
              $ref: '#/components/headers/GS1-EPC-Format'
            GS1-Extensions:
              $ref: '#/components/headers/GS1-Extensions'
            Link:
               $ref: '#/components/headers/Link'
            GS1-Next-Page-Token-Expires:
              $ref: '#/components/headers/GS1-Next-Page-Token-Expires'
          description: |
            Returns a list of electronic product codes. If there are more electronic product codes than specified by the
            `perPage` parameter, the client will be given the URL to retrieve more electronic product codes in the
            `Link` header.
            If the client specifies extension mappings, the response will use them where they match. Otherwise,
            the full resource address is used.
          content:
            application/json:
              schema:
                example:
                  - urn:epc:id:sgtin:0614141.107346.2018
                  - https://example.com/01/04012345123456
                  - urn:epc:id:sgtin:0614141.107346.2017
                type: array
                items:
                  type: string
                  format: uri
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /epcs/{epc}:
    parameters:
      - $ref: '#/components/parameters/EPC'
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Query metadata of the electronic product code.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
          '204':
            $ref: '#/components/responses/204DefaultDiscoveryResponse'
          '401':
            $ref: '#/components/responses/401UnauthorizedRequest'
          '403':
            $ref: '#/components/responses/403ClientUnauthorized'
          '404':
            $ref: '#/components/responses/404ResourceNotFound'
          '406':
            $ref: '#/components/responses/406NotAcceptable'
          '500':
            $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Top-level'
      summary: Returns all sub-resources of an electronic product code.
      description: |
        This endpoint returns all sub-resources of an electronic product code, which currently is `events`.
      responses:
        '200':
          $ref: '#/components/responses/200TopLevelOrEventTypeSubResource'
        '400':
          $ref: '#/components/responses/400QueryIssues'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /epcs/{epc}/events:
    parameters:
      - $ref: '#/components/parameters/EPC'
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Query the metadata of the endpoint to access EPCIS events by EPC in a URN or constrained GS1 Digital Link form (URL encoded).
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204EventsEndpointDiscovery'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '414':
          $ref: '#/components/responses/414URLTooLong'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Events'
      summary: Returns EPCIS events matching the specified electronic product code.
      parameters:
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-CBV-Min'
        - $ref: '#/components/parameters/GS1-CBV-Max'
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
        - $ref: '#/components/parameters/GS1-EPC-Format'
        - $ref: '#/components/parameters/GS1-CBV-XML-Format'

      description: |
        This endpoint helps to navigate EPCIS events by electronic product codes. It returns
        EPCIS events up to the amount defined in `perPage`. If applicable, the server returns a `Link` header to point to the remaining
        results. Optionally, EPCIS events can be further filtered using the <a href="https://github.com/gs1/EPCIS/tree/master/REST%20Bindings/query-schema.json">EPCIS Query Language</a> in as query string parameters.

        Example 1 - EPC in a URN form with <a href="https://github.com/gs1/EPCIS/tree/master/REST%20Bindings/query-schema.json">EPCIS Query Language</a> filtering

        ```
        https://example.com/epcs/urn:epc:id:sgtin:0614141.107346.2018?EQ_bizStep=shipping%7Cdecommissioning&GE_eventTime=2015-03-15T00%3A00%3A00.000-04%3A00
        ```
        
        Example 2  - EPC in a constrained GS1 Digital Link form (URL encoded)
        ```
        https://example.com/epcs/https:%2f%2fexample.org%2f01%2f1234567089012400
        ```
      responses:
        '200':
          $ref: '#/components/responses/200EPCISQueryDocument'
        '400':
          $ref: '#/components/responses/400QueryIssues'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '414':
          $ref: '#/components/responses/414URLTooLong'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'


  /bizSteps:
    parameters:
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Query metadata related to the business steps endpoint.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204DefaultDiscoveryResponse'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Top-level'
      parameters:
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-CBV-Min'
        - $ref: '#/components/parameters/GS1-CBV-Max'
        - $ref: '#/components/parameters/GS1-CBV-XML-Format'
      summary: Returns known business steps.
      description: |
        An endpoint to list business steps.
        This endpoint supports pagination.
      responses:
        '200':
          headers:
            $ref: '#/components/responses/200TopLevelResponse/headers'
          description: |
            Returns a list of business steps. If there are more business steps than specified by the
            `perPage` parameter, the client will be given the URL to retrieve more business steps in the `Link` header.
            If the client specifies extension mappings, the response will use them where they match. Otherwise,
            the full resource address is used.
          content:
            application/json:
              schema: 
                $ref: '#/components/schemas/BizStepItemList'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /bizSteps/{bizStep}:
    parameters:
      - $ref: '#/components/parameters/BizStep'
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Query metadata of the endpoint to access an individual business step.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204DefaultDiscoveryResponse'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Top-level'
      summary: Returns all sub-resources of a business step.
      description: |
        This endpoint returns all sub-resources of a business step, which currently is `events`.
      responses:
        '200':
          $ref: '#/components/responses/200TopLevelOrEventTypeSubResource'
        '400':
          $ref: '#/components/responses/400QueryIssues'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'


  /bizSteps/{bizStep}/events:
    parameters:
      - $ref: '#/components/parameters/BizStep'
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Query the metadata of the endpoint to access EPCIS events by business step.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204EventsEndpointDiscovery'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '414':
          $ref: '#/components/responses/414URLTooLong'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Events'
      summary: Returns all EPCIS events related to the business step.
      parameters:
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-CBV-Min'
        - $ref: '#/components/parameters/GS1-CBV-Max'
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
        - $ref: '#/components/parameters/GS1-EPC-Format'
        - $ref: '#/components/parameters/GS1-CBV-XML-Format'
      description: |
        This endpoint helps to navigate EPCIS events by business steps. It returns
        EPCIS events up to the amount defined in `perPage`. The server returns a `Link` header to point to the
        remaining results.  Optionally, EPCIS events can be further filtered using the <a href="https://github.com/gs1/EPCIS/tree/master/REST%20Bindings/query-schema.json">EPCIS Query Language</a> in as query
        string parameters.

        Example:

        ```
        https://example.com/bizSteps/receiving?GE_eventTime=2015-03-15T00%3A00%3A00.000-04%3A00
        ```
      responses:
        '200':
          $ref: '#/components/responses/200EPCISQueryDocument'
        '400':
          $ref: '#/components/responses/400QueryIssues'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '414':
          $ref: '#/components/responses/414URLTooLong'

        '500':
          $ref: '#/components/responses/500ImplementationException'

  /bizLocations:
    parameters:
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Query the metadata related to the business locations endpoint.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204DefaultDiscoveryResponse'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Top-level'
      parameters:
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-CBV-Min'
        - $ref: '#/components/parameters/GS1-CBV-Max'
        - $ref: '#/components/parameters/GS1-EPC-Format'
      summary: Returns known business locations.
      description: |
        An endpoint to list business locations.
        This endpoint supports pagination.
      responses:
        '200':
          headers:
            $ref: '#/components/responses/200TopLevelResponse/headers'
          description: |
            Returns a list of business locations. If there are more business locations than specified by the
            `perPage` parameter, the client will be given the URL to retrieve more business locations in the `Link` header.
            If the client specifies extension mappings, the response will use them where they match. Otherwise,
            the full resource address is used.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BizLocationItemList'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /bizLocations/{bizLocation}:
    parameters:
      - $ref: '#/components/parameters/BizLocation'
    options:
      tags:
        - 'Discovery'
      summary: Query the metadata of the endpoint to access an individual business location.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204DefaultDiscoveryResponse'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Top-level'
      summary: Returns all sub-resources of a business location.
      parameters:
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/NextPageToken'
      description: |
        This endpoint returns all sub-resources of a business location, which currently is `events`.
      responses:
        '200':
          $ref: '#/components/responses/200TopLevelOrEventTypeSubResource'
        '400':
          $ref: '#/components/responses/400QueryIssues'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /readPoints:
    parameters:
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Query the metadata related to the read points endpoint.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204DefaultDiscoveryResponse'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Top-level'
      parameters:
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-CBV-Min'
        - $ref: '#/components/parameters/GS1-CBV-Max'
        - $ref: '#/components/parameters/GS1-EPC-Format'
      summary: Returns known read points.
      description: |
        An endpoint to list read points.
        This endpoint supports pagination.
      responses:
        '200':
          headers:
            $ref: '#/components/responses/200TopLevelResponse/headers'
          description: |
            Returns a list of read points. If there are more read points than specified by the
            `perPage` parameter, the client will be given the URL to retrieve more read points in the `Link` header.
            If the client specifies extension mappings, the response will use them where they match. Otherwise,
            the full resource address is used.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReadPointItemList'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /readPoints/{readPoint}:
    parameters:
      - $ref: '#/components/parameters/ReadPoint'
    options:
      tags:
        - 'Discovery'
      summary: Query the metadata of the endpoint to access an individual read point.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204DefaultDiscoveryResponse'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Top-level'
      summary: Returns all sub-resources of a read point.
      parameters:
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/NextPageToken'
      description: |
        This endpoint returns all sub-resources of a read point, which currently is `events`.
      responses:
        '200':
          $ref: '#/components/responses/200TopLevelOrEventTypeSubResource'
        '400':
          $ref: '#/components/responses/400QueryIssues'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /readPoints/{readPoint}/events:
    parameters:
      - $ref: '#/components/parameters/ReadPoint'
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Query the metadata of the endpoint to access EPCIS events by read point.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204EventsEndpointDiscovery'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '414':
          $ref: '#/components/responses/414URLTooLong'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Events'
      summary: Returns all EPCIS events related to the read point.
      parameters:
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-CBV-Min'
        - $ref: '#/components/parameters/GS1-CBV-Max'
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
        - $ref: '#/components/parameters/GS1-EPC-Format'
        - $ref: '#/components/parameters/GS1-CBV-XML-Format'
      description: |
        This endpoint helps to navigate EPCIS events by read points. It returns
        EPCIS events up to the amount defined in `perPage`. The server returns a `Link` header to point to the remaining
        results.

        Optionally, EPCIS events can be further filtered using the <a href="https://github.com/gs1/EPCIS/tree/master/REST%20Bindings/query-schema.json">EPCIS Query Language</a> in as query string parameters.

        Example:

        ```
        https://example.com/readPoints/urn:epc:id:sgln:0012345.11111.400?GE_eventTime=2015-03-15T00%3A00%3A00.000-04%3A00
        ```
      responses:
        '200':
          $ref: '#/components/responses/200EPCISQueryDocument'
        '400':
          $ref: '#/components/responses/400QueryIssues'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '414':
          $ref: '#/components/responses/414URLTooLong'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /dispositions:
    parameters:
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Query the metadata related to the dispositions endpoint.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204DefaultDiscoveryResponse'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Top-level'
      parameters:
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-CBV-Min'
        - $ref: '#/components/parameters/GS1-CBV-Max'
        - $ref: '#/components/parameters/GS1-CBV-XML-Format'
      summary: Returns known dispositions.
      description: |
        An endpoint to list dispositions.
        This endpoint supports pagination.
      responses:
        '200':
          headers:
            $ref: '#/components/responses/200TopLevelResponse/headers'
          description: |
            Returns a list of dispositions. If there are more dispositions than specified by the
            `perPage` parameter, the client will be given the URL to retrieve more dispositions in the `Link` header.
            If the client specifies extension mappings, the response will use them where they match. Otherwise,
            the full resource address is used.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DispositionItemList'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /dispositions/{disposition}:
    parameters:
      - $ref: '#/components/parameters/GS1-Extensions'
      - $ref: '#/components/parameters/Disposition'
    options:
      tags:
        - 'Discovery'
      summary: Query the metadata of the endpoint to access an individual disposition.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204DefaultDiscoveryResponse'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
        
    get:
      tags:
        - 'Top-level'
      summary: Returns all sub-resources of a disposition.
      description: |
        This endpoint returns all sub-resources of a disposition, which currently is `events`.
      responses:
        '200':
          $ref: '#/components/responses/200TopLevelOrEventTypeSubResource'
        '400':
          $ref: '#/components/responses/400QueryIssues'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /dispositions/{disposition}/events:
    parameters:
      - $ref: '#/components/parameters/Disposition'
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Query the metadata of the endpoint to access EPCIS events by disposition.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204EventsEndpointDiscovery'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '414':
          $ref: '#/components/responses/414URLTooLong'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Events'
      summary: Returns all EPCIS events related to the disposition.
      parameters:
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-CBV-Min'
        - $ref: '#/components/parameters/GS1-CBV-Max'
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
        - $ref: '#/components/parameters/GS1-EPC-Format'
        - $ref: '#/components/parameters/GS1-CBV-XML-Format'

      description: |
        This endpoint helps to navigate EPCIS events by dispositions. It returns
        EPCIS events up to the amount defined in `perPage`. The server returns a `Link` header to point to the remaining
        results.
        Optionally, EPCIS events can be further filtered using the <a href="https://github.com/gs1/EPCIS/tree/master/REST%20Bindings/query-schema.json">EPCIS Query Language</a> in as query string parameters.

        Example:

        ```
        https://example.com/dispositions/in_progress?GE_eventTime=2015-03-15T00%3A00%3A00.000-04%3A00
        ```
      responses:
        '200':
          $ref: '#/components/responses/200EPCISQueryDocument'
        '400':
          $ref: '#/components/responses/400QueryIssues'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '414':
          $ref: '#/components/responses/414URLTooLong'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /queries:
    options:
      tags:
        - 'Discovery'
      summary: Query the metadata of the EPCIS queries endpoint.
      parameters:
        - $ref: '#/components/parameters/GS1-Extensions'
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204WritableResourcesDiscovery'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Queries'
      parameters:
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/GS1-Extensions'
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-CBV-Min'
        - $ref: '#/components/parameters/GS1-CBV-Max'
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
      summary: Returns a list of queries available.
      description: |
        An endpoint to list named queries.
        This endpoint supports pagination.
      responses:
        '200':
          headers:
            GS1-EPCIS-Version:
              $ref: '#/components/headers/GS1-EPCIS-Version'
            GS1-CBV-Version:
              $ref: '#/components/headers/GS1-CBV-Version'
            GS1-EPC-Format:
              $ref: '#/components/headers/GS1-EPC-Format'
            GS1-CBV-XML-Format:
              $ref: '#/components/headers/GS1-CBV-XML-Format'
            GS1-Extensions:
              $ref: '#/components/headers/GS1-Extensions'
            Link:
              $ref: '#/components/headers/Link'
            GS1-Next-Page-Token-Expires:
              $ref: '#/components/headers/GS1-Next-Page-Token-Expires'
          description: |
            Queries are like views that are created using the <a href="https://github.com/gs1/EPCIS/tree/master/REST%20Bindings/query-schema.json">EPCIS Query Language</a>. Each query object
            consists of a query name and the query definition. Performing a `GET` on `/queries` lists all
            existing queries.
          content:
            application/json:
              example: |
                [{
                  "query": {
                  "EQ_bizStep": [
                      "shipping",
                      "receiving"
                  ],
                  "eventType": ["ObjectEvent"]
                },
                "name": "myQuery"
                }]
              schema:
                description: The query name.
                type: array
                items:
                  allOf:
                    - type: object
                      required:
                        - name
                      properties:
                        name:
                          $ref: '#/components/schemas/QueryName'
                    - $ref: '#/components/schemas/QueryDefinition'
                uniqueItems: true
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

    post:
      tags:
        - 'Queries'
      summary: |
        Creates a named EPCIS events query.
      parameters:
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-EPC-Format'
        - $ref: '#/components/parameters/GS1-CBV-XML-Format'
        - $ref: '#/components/parameters/GS1-Extensions'
      description: |
        Creating a named query creates a view on the events in the repository, accessible through its events resource.
        To obtain the named query results, the client can use the URL in the `Location` header. The client can also use this URL to start a query subscription immediately after creating the query.
      requestBody:
        $ref: '#/components/requestBodies/CreateQuery'
      responses:
        '201':
          headers:
            GS1-EPCIS-Version:
              $ref: '#/components/headers/GS1-EPCIS-Version'
            GS1-CBV-Version:
              $ref: '#/components/headers/GS1-CBV-Version'
            GS1-EPC-Format:
              $ref: '#/components/headers/GS1-EPC-Format'
            GS1-CBV-XML-Format:
              $ref: '#/components/headers/GS1-CBV-XML-Format'
            GS1-Extensions:
              $ref: '#/components/headers/GS1-Extensions'
            Location:
              description: |
                The URL of the created query. The client can use the `Location` URL to obtain the named query definition.
              schema:
                example: "https://www.example.com/queries/myQuery"
                type: string
                format: uri
          description: Creates the named query.
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '415':
          $ref: '#/components/responses/415UnsupportedMediaType'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /queries/{queryName}:
    parameters:
      - $ref: '#/components/parameters/QueryName'
    get:
      parameters:
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
        - $ref: '#/components/parameters/GS1-Extensions'
      tags:
        - 'Queries'
      summary: Returns the query definition.
      responses:
        '200':
          headers:
            GS1-EPCIS-Version:
              $ref: '#/components/headers/GS1-EPCIS-Version'
            GS1-CBV-Version:
              $ref: '#/components/headers/GS1-CBV-Version'
            GS1-EPC-Format:
              $ref: '#/components/headers/GS1-EPC-Format'
            GS1-CBV-XML-Format:
              $ref: '#/components/headers/GS1-CBV-XML-Format'
            GS1-Extensions:
              $ref: '#/components/headers/GS1-Extensions'
          description: |
            Queries are like views that are created using the <a href="https://github.com/gs1/EPCIS/tree/master/REST%20Bindings/query-schema.json">EPCIS Query Language</a>. Each query object
            consists of a query name and the query definition.
          content:
            application/json:
              example: {
                "name": "myQuery",
                "query": {
                  "EQ_bizStep": [
                      "shipping",
                      "receiving"
                  ],
                  "eventType": ["ObjectEvent"]
                }
              }
              schema:
                type: array
                items:
                  allOf:
                    - type: object
                      required:
                        - name
                      properties:
                        name:
                          type: string
                    - $ref: '#/components/schemas/QueryDefinition'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '413':
          $ref: '#/components/responses/413QueryScopeOrSize'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    options:
      parameters:
        - $ref: '#/components/parameters/GS1-Extensions'
      tags:
        - 'Discovery'
      summary: Query the metadata of the named queries endpoint.
      description: |
        EPCIS 2.0 supports a number of custom headers to describe custom vocabularies and support multiple versions
        of EPCIS and CBV. The `OPTIONS` method allows the client to discover which vocabularies and EPCIS and CBV
        versions are used.
      responses:
        '204':
          $ref: '#/components/responses/204RemovableResourcesDiscovery'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    delete:
      tags:
        - 'Queries'
      summary: Removes a named query and forcibly unsubscribes all active subscriptions, whether by WebSockets or Webhooks
      responses:
        '204':
          $ref: '#/components/responses/204QueryDeleted'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /queries/{queryName}/subscriptions:
    parameters:
      - $ref: '#/components/parameters/QueryName'
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Query the metadata of the subscriptions endpoint.
      description: |
        The `OPTIONS` method is used as a discovery service for query subscriptions.
      responses:
        '204':
          description: |
            The `OPTIONS` method returns information describing the  `subscriptions`  endpoint.
            The list of headers is not exhaustive. It only describes the functionality specific to EPCIS 2.0.
          headers:
            $ref: '#/components/responses/204WritableResourcesDiscovery/headers'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Queries'
        - 'Subscriptions'
      summary: Returns active subscriptions with the option to use pagination if needed.
      parameters:
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
      description: |
        The `GET` endpoint is to list all active subscriptions on that query.
      responses:
        '200':
          headers:
            GS1-EPCIS-Version:
              $ref: '#/components/headers/GS1-EPCIS-Version'
            GS1-Extensions:
              $ref: '#/components/headers/GS1-Extensions'
            Link:
              $ref: '#/components/headers/Link'
            GS1-Next-Page-Token-Expires:
              $ref: '#/components/headers/GS1-Next-Page-Token-Expires'
          description: Returns active subscriptions.
          content:
            application/json:
              example: [
                {
                  "subscriptionID": "df5a33e3-5aa3-4403-ae01-99b83234e27b",
                  "createdAt": "2017-08-21T17:32:28Z",
                  "schedule": {
                    "hour": "1",
                    "minute": "5"
                  }
                },
                {
                  "subscriptionID": "df5a33e3-5aa3-5504-bf12-88c94345f38c",
                  "createdAt": "2017-07-21T17:32:28Z",
                  "stream": true
                }
              ]
              schema:
                type: array
                items:
                  allOf:
                    - $ref: '#/components/schemas/AbstractQuerySubscriptionResponse'
                    - oneOf:
                        - $ref: '#/components/schemas/QueryScheduleSubscription'
                        - $ref: '#/components/schemas/QueryStreamSubscription'

        '400':
          $ref: '#/components/responses/400SubscriptionIssues'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    post:
      tags:
        - 'Queries'
        - 'Subscriptions'
      summary: Creates a query subscription.
      parameters:
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
      description: |
        Creating a query subscription requires the client to provide a single endpoint to which the
        server will send events (as `EPCISQueryDocument`) and a subscription secret that the server needs to authenticate itself when
        sending events. The subscription secret must be generated by the client. 
        EPCIS 2.0 implementations must support Webhook subscriptions. 

        When the client subscribes to a query, it must either set `stream` to `true`, to be notified whenever a new EPCIS
        event matches the query, or the client must define a query schedule. If these are missing the query subscription is invalid because the server won't
        know when to notify a client.

        ## Scheduled query: Receive query results at 1.05am

        A scheduled query subscription is a time-based query execution. EPCIS 2.0 scheduled queries are scheduled
        in the same manner as cron jobs.

        For example, this query subscription is scheduled to trigger every morning at 1.05am. By setting
        `reportIfEmpty` to `true`, the client's callback URL (`dest`) will be called even if there are no new events that match
        the query.

        ```
        POST /queries/MyQuery/subscriptions
        {
          "dest": "https://client.example.com/queryCallback",
          "secret": "0435ojtojt02",
          "reportIfEmpty": true,
          "schedule": {
            "hour":"1",
            "minute": "5"
          }
        }
        ```

        ## Streaming query subscription: Whenever a captured EPCIS event matches the query criteria

        If no query schedule is specified, the client must explicitly set `stream` to `true`. This restriction is to
        prevent clients from accidentally subscribing to EPCIS event streams.

        ```
        POST /queries/MyQuery/subscriptions
        {
          "dest": "https://client.example.com/queryCallback",
          "secret": "0435ojtojt02",
          "stream": true
        }
        ```

      requestBody:
        content:
          application/json:
            example: {
              "dest": "https://client.example.com/queryCallback",
              "secret": "0435ojtojt02",
              "schedule": { "hour": "1", "minute": "5" }
            }
            schema:
              allOf:
                - $ref: '#/components/schemas/AbstractQuerySubscription'
                - oneOf:
                    - $ref: '#/components/schemas/QueryScheduleSubscription'
                    - $ref: '#/components/schemas/QueryStreamSubscription'
      responses:
        '201':
          headers:
            Location:
              example: 'https://www.example.com/queries/MyQuery/subscriptions/df5a33e3-5aa3-4403-ae01-99b83234e27b'
              description: |
                The server creates a new subscription for each client and query subscription. The client needs that URL
                to unsubscribe by deleting this resource. The `Location` URL must point to the `subscriptionID` returned
                in the response body. Note that for security reasons the response should not
                return the secret.
              schema:
                type: string
                format: uri
          description: Query subscription successful. The subscription is valid until the client unsubscribes.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/AbstractQuerySubscriptionResponse'
                  - oneOf:
                      - $ref: '#/components/schemas/QueryScheduleSubscription'
                      - $ref: '#/components/schemas/QueryStreamSubscription'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '415':
          $ref: '#/components/responses/415UnsupportedMediaType'
        '500':
          $ref: '#/components/responses/500ImplementationException'

      callbacks:
        querySubscriptionResults:
          '{$request.body#/dest}?secret={$request.body#/secret}':
            post:
              summary: Callback invoked by the server to provide the query result to the client.
              requestBody:
                description: |
                  The server sends the query result to the client as a series of `EPCISQueryDocument`. There is no pagination for a `POST` request, the
                  server must either send each EPCIS event individually or group EPCIS events in manageable batches.

                  If an error occurs server-side, the server must send the error in the format that is already used for
                  returning `4xx` or `5xx` responses.
                required: true
                content:
                  application/json:
                    schema:
                      oneOf:
                        - $ref: '#/components/schemas/EPCISQueryDocument'
                        - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
              responses:
                '200':
                  description: Webhook successfully processed the server request.
                '401':
                  $ref: '#/components/responses/401UnauthorizedRequest'
                '403':
                  $ref: '#/components/responses/403ClientUnauthorized'
                '413':
                  description: |
                    The `POST` request is too large. The client can't handle a payload of this size at once and
                    asks the server to send EPCIS events in smaller batches.
                  content:
                    application/problem+json:
                      schema:
                        allOf:
                          - properties:
                              status:
                                type: integer
                                enum:
                                  - 413
                                default: 413
                              type:
                                type: string
                                format: uri
                                enum:
                                  - epcisException:QueryTooComplexException
                          - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
                '415':
                  $ref: '#/components/responses/415UnsupportedMediaType'
  /queries/{queryName}/subscriptions/{subscriptionID}:
    parameters:
      - $ref: '#/components/parameters/QueryName'
      - in: path
        name: subscriptionID
        required: true
        example: df5a33e3-5aa3-4403-ae01-99b83234e27b
        schema:
          $ref: '#/components/schemas/subscriptionID'
    options:
      parameters:
        - $ref: '#/components/parameters/GS1-Extensions'
      tags:
        - 'Discovery'
      summary: Query the metadata of the endpoint for an individual subscription.
      description: |
        The `OPTIONS` method is used to discover capabilities for a query subscription.
      responses:
        '204':
          $ref: '#/components/responses/204SubscriptionEndpointDiscovery'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Queries'
        - 'Subscriptions'
      summary: Returns the details of a subscription. This method is useful to verify if a subscription is still active.
      parameters:
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
        - $ref: '#/components/parameters/GS1-Extensions'
      responses:
        '200':
          headers:
            'GS1-Extensions': 
              $ref: '#/components/headers/GS1-Extensions'
            GS1-EPCIS-Version: 
              $ref: '#/components/headers/GS1-EPCIS-Version'
          description: |
            The `GET` method on a query subscription allows the client to get the details of an individual subscription.
          content:
            application/json:
              example:
                {
                  "subscriptionID": "7cec849f-72f7-4a9d-bc86-080d3c5b7c98",
                  "queryName": "GetIlmdExtension",
                  "dest": "http://example.com/testWebhookSubscription",
                  "initialRecordTime": "2022-01-06T06:52:24.880Z",
                  "reportIfEmpty": true,
                  "schedule": {
                      "second": "0/30"
                  },
                  "createdAt": "2022-01-06T06:52:24.889Z"
                }
              schema:
                allOf:
                  - $ref: '#/components/schemas/AbstractQuerySubscriptionResponse'
                  - oneOf:
                      - $ref: '#/components/schemas/QueryScheduleSubscription'
                      - $ref: '#/components/schemas/QueryStreamSubscription'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    delete:
      operationId: unsubscribe
      tags:
        - 'Queries'
        - 'Subscriptions'
      summary: Unsubscribes a client by deleting the query subscription.
      responses:
        '204':
          description: Client unsubscribed from query.
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /queries/{queryName}/events:
    parameters:
      - $ref: '#/components/parameters/QueryName'
      - $ref: '#/components/parameters/GS1-Extensions'
    options:
      tags:
        - 'Discovery'
      summary: Query the metadata of the EPCIS events query result endpoint.
      description: |
        The `OPTIONS` method is used to discover capabilities for named queries. It describes which EPCIS and CBV
        versions are used in the query result supported as well as EPCIS and CBV extensions.

      responses:
        '204':
          $ref: '#/components/responses/204EventsEndpointDiscovery'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '414':
          $ref: '#/components/responses/414URLTooLong'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      tags:
        - 'Queries'
        - 'Events'
      summary: |
        Returns EPCIS events with the option to use pagination if needed. This endpoint supports query subscriptions
        using WebSockets.
      parameters:
        - $ref: '#/components/parameters/Upgrade'
        - $ref: '#/components/parameters/Connection'
        - $ref: '#/components/parameters/GS1-Query-ReportIfEmpty'
        - $ref: '#/components/parameters/GS1-Query-InitialRecordTime'
        - $ref: '#/components/parameters/GS1-Query-Second'
        - $ref: '#/components/parameters/GS1-Query-Minute'
        - $ref: '#/components/parameters/GS1-Query-Hour'
        - $ref: '#/components/parameters/GS1-Query-DayOfMonth'
        - $ref: '#/components/parameters/GS1-Query-Month'
        - $ref: '#/components/parameters/GS1-Query-DayOfWeek'
        - $ref: '#/components/parameters/GS1-Query-Stream'
        # Common /events parameters
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/GS1-CBV-Version'
        - $ref: '#/components/parameters/GS1-CBV-Min'
        - $ref: '#/components/parameters/GS1-CBV-Max'
        - $ref: '#/components/parameters/GS1-EPCIS-Version'
        - $ref: '#/components/parameters/GS1-EPCIS-Min'
        - $ref: '#/components/parameters/GS1-EPCIS-Max'
        - $ref: '#/components/parameters/GS1-EPC-Format'
        - $ref: '#/components/parameters/GS1-CBV-XML-Format'

      description: |
        The `GET` endpoint  is to retrieve results of a named query.
        Furthermore, this endpoint can also be used to subscribe to queries using Websocket. To do this, the client
        must specify the query schedule or set the `stream` parameter to `true` as a URL query string parameter. Please
        note that scheduling parameters and the `stream` parameter are mutually exclusive.

        ## Scheduled query: Receive query results at 1.05am

        Handshake from client for scheduled query:

        ```
        GET https://example.com/queries/MyQuery/events?minute=5&hour=1
        Host: example.com
        Upgrade: websocket
        Connection: Upgrade
        ```

        Handshake from the server:

        ```
        HTTP/1.1 101 Switching Protocols
        Upgrade: websocket
        Connection: Upgrade
        ```

        ## Streaming query subscription: Whenever a captured EPCIS event matches the query criteria

        Handshake from client for streaming:

        ```
        GET https://example.com/queries/MyQuery/events?stream=true
        Host: example.com
        Upgrade: websocket
        Connection: Upgrade
        ```

        Handshake from the server:

        ```
        HTTP/1.1 101 Switching Protocols
        Upgrade: websocket
        Connection: Upgrade
        ```
      responses:
        '101':
          $ref: '#/components/responses/101WebsocketCreated'
        '200':
          $ref: '#/components/responses/200EPCISQueryDocument'
        '400':
          $ref: '#/components/responses/400SubscriptionIssues'
        '401':
          $ref: '#/components/responses/401UnauthorizedRequest'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '414':
          $ref: '#/components/responses/414URLTooLong'
        '413':
          $ref: '#/components/responses/413QueryScopeOrSize'
        '406':
          $ref: '#/components/responses/406NotAcceptable'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /nextPageToken/{token}:
    parameters:
      - $ref: '#/components/parameters/Token'
    delete:
      tags:
        - 'Queries'
      summary: Optional endpoint that allows on-demand release of any resources associated with `nextPageToken`.
      responses:
        '204':
          $ref: '#/components/responses/204NextPageTokenInvalidated'
        '501':
          $ref: '#/components/responses/501NotImplemented'

components:
  responses:
    101WebsocketCreated:
      description: |
        Create a WebSocket connection to subscribe to queries. Upon subscription, the server SHALL send all new events
        to subscribing clients. If multiple clients have the same query, each client will receive events which they are
        authorized to see.
      headers:
        Upgrade:
          required: true
          schema:
            type: string
            default: websocket
        Connection:
          required: true
          schema:
            type: string
            default: upgrade
        GS1-Query-Min-Record-Time:
          required: false
          schema:
            $ref: '#/components/schemas/GS1-Query-Min-Record-Time'
    200TopLevelOrEventTypeSubResource:
      headers:
        GS1-EPCIS-Version:
          $ref: '#/components/headers/GS1-EPCIS-Version'
        GS1-EPCIS-Min:
          $ref: '#/components/headers/GS1-EPCIS-Min'
        GS1-EPCIS-Max:
          $ref: '#/components/headers/GS1-EPCIS-Max'
        GS1-EPC-Format:
          $ref: '#/components/headers/GS1-EPC-Format'
        GS1-CBV-XML-Format:
          $ref: '#/components/headers/GS1-CBV-XML-Format'
        GS1-CBV-Version:
          $ref: '#/components/headers/GS1-CBV-Version'
        GS1-Extensions:
          $ref: '#/components/headers/GS1-Extensions'
      description: Returns the relative path `events`.
      content:
        application/json:
          example:
            - events
          schema:
            type: array
            items:
              format: string
              enum:
                - events
    200EPCISQueryDocument:
      headers:
        GS1-EPCIS-Version:
          $ref: '#/components/headers/GS1-EPCIS-Version'
        GS1-CBV-Version:
          $ref: '#/components/headers/GS1-CBV-Version'
        GS1-Extensions:
          $ref: '#/components/headers/GS1-Extensions'
        GS1-EPC-Format:
          $ref: '#/components/headers/GS1-EPC-Format'
        GS1-CBV-XML-Format:
          $ref: '#/components/headers/GS1-CBV-XML-Format'
        Link:
          $ref: '#/components/headers/Link'
        GS1-Next-Page-Token-Expires:
          $ref: '#/components/headers/GS1-Next-Page-Token-Expires'
      description: Contains EPCIS events.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EPCISQueryDocument'
    200EPCISQueryDocumentSinglePage:
      headers:
        GS1-EPCIS-Version:
          $ref: '#/components/headers/GS1-EPCIS-Version'
        GS1-CBV-Version:
          $ref: '#/components/headers/GS1-CBV-Version'
        GS1-Extensions:
          $ref: '#/components/headers/GS1-Extensions'
        GS1-EPC-Format:
          $ref: '#/components/headers/GS1-EPC-Format'
        GS1-CBV-XML-Format:
          $ref: '#/components/headers/GS1-CBV-XML-Format'
      description: EPCIS Query Document containing events with the requested `eventID`.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EPCISQueryDocument'
    204NextPageTokenInvalidated:
      description: nextPageToken invalidated successfully.
    200SupportedTopLevel:
      description: Returns all supported EPCIS top-level resources.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/TopLevelResources'
    200TopLevelResponse:
      description: Response headers of all top level resources
      headers:
        GS1-Extensions:
          $ref: '#/components/headers/GS1-Extensions'
        GS1-EPCIS-Version:
          $ref: '#/components/headers/GS1-EPCIS-Version'
        GS1-CBV-Version:
          $ref: '#/components/headers/GS1-CBV-Version'
        GS1-CBV-XML-Format:
          $ref: '#/components/headers/GS1-CBV-XML-Format'
        Link:
          $ref: '#/components/headers/Link'
        GS1-Next-Page-Token-Expires:
          $ref: '#/components/headers/GS1-Next-Page-Token-Expires'
    200SupportedEventTypes:
      description: Returns all supported EPCIS event types.
      headers:
        $ref: '#/components/responses/200TopLevelResponse/headers'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EventTypeItemList'
    204DefaultDiscoveryResponse:
      description: |
        The `OPTIONS` method is used to discover capabilities for EPCIS 2.0 endpoints.
        It describes which EPCIS and CBV versions are supported and used for the top-level resource as well as EPCIS and
        CBV extensions. The list of headers is not exhaustive. It only describes the functionality specific to EPCIS 2.0.
      headers:
        Allow:
          description: Lists the set of methods supported by the resource. 
          schema:
            example: OPTIONS, GET
            type: string
            default: 'OPTIONS, GET'
        GS1-EPCIS-Min:
          $ref: '#/components/headers/GS1-EPCIS-Min'
        GS1-EPCIS-Max:
          $ref: '#/components/headers/GS1-EPCIS-Max'
        GS1-CBV-Min:
          $ref: '#/components/headers/GS1-CBV-Min'
        GS1-CBV-Max:
          $ref: '#/components/headers/GS1-CBV-Max'
        GS1-EPC-Format:
          $ref: '#/components/headers/GS1-EPC-Format'
        GS1-CBV-XML-Format:
          $ref: '#/components/headers/GS1-CBV-XML-Format'
        GS1-Extensions:
          $ref: '#/components/headers/GS1-Extensions'
        GS1-Vendor-Version:
          $ref: '#/components/headers/GS1-Vendor-Version'
    204WritableResourcesDiscovery:
      description: 
        $ref: '#/components/responses/204DefaultDiscoveryResponse/description'
      headers:
        Allow:
          description: Lists the set of methods supported by the resource. 
          schema:
            example: OPTIONS, GET, POST
            type: string
            default: 'OPTIONS, GET, POST'
        GS1-EPCIS-Min:
          $ref: '#/components/headers/GS1-EPCIS-Min'
        GS1-EPCIS-Max:
          $ref: '#/components/headers/GS1-EPCIS-Max'
        GS1-CBV-Min:
          $ref: '#/components/headers/GS1-CBV-Min'
        GS1-CBV-Max:
          $ref: '#/components/headers/GS1-CBV-Max'
        GS1-EPC-Format:
          $ref: '#/components/headers/GS1-EPC-Format'
        GS1-CBV-XML-Format:
          $ref: '#/components/headers/GS1-CBV-XML-Format'
        GS1-Extensions:
          $ref: '#/components/headers/GS1-Extensions'
        GS1-Vendor-Version:
          $ref: '#/components/headers/GS1-Vendor-Version'
    204RemovableResourcesDiscovery:
      description: 
        $ref: '#/components/responses/204DefaultDiscoveryResponse/description'
      headers:
        Allow:
          description: Lists the set of methods supported by the resource. 
          schema:
            example: OPTIONS, GET, DELETE
            type: string
            default: 'OPTIONS, GET, DELETE'
        GS1-EPCIS-Min:
          $ref: '#/components/headers/GS1-EPCIS-Min'
        GS1-EPCIS-Max:
          $ref: '#/components/headers/GS1-EPCIS-Max'
        GS1-CBV-Min:
          $ref: '#/components/headers/GS1-CBV-Min'
        GS1-CBV-Max:
          $ref: '#/components/headers/GS1-CBV-Max'
        GS1-EPC-Format:
          $ref: '#/components/headers/GS1-EPC-Format'
        GS1-CBV-XML-Format:
          $ref: '#/components/headers/GS1-CBV-XML-Format'
        GS1-Extensions:
          $ref: '#/components/headers/GS1-Extensions'
        GS1-Vendor-Version:
          $ref: '#/components/headers/GS1-Vendor-Version'
    204EventsEndpointDiscovery:
      description: |
        The `OPTIONS` method is used to discover capabilities for `events` endpoints. It describes which EPCIS and CBV
        versions are supported as well as  EPCIS and CBV extensions.
        The list of headers is not exhaustive. It only describes the functionality specific to EPCIS 2.0.
      headers:
        $ref: '#/components/responses/204DefaultDiscoveryResponse/headers'
    204CaptureEndpointDiscovery:
      description:
        $ref: '#/components/responses/204DefaultDiscoveryResponse/description'
      headers:
        Allow:
          description: Lists the set of methods supported by the resource. 
          schema:
            example: OPTIONS, POST, GET
            type: string
            default: OPTIONS, POST, GET
        GS1-EPCIS-Min:
          $ref: '#/components/headers/GS1-EPCIS-Min'
        GS1-EPCIS-Max:
          $ref: '#/components/headers/GS1-EPCIS-Max'
        GS1-CBV-Min:
          $ref: '#/components/headers/GS1-CBV-Min'
        GS1-CBV-Max:
          $ref: '#/components/headers/GS1-CBV-Max'
        GS1-EPC-Format:
          $ref: '#/components/headers/GS1-EPC-Format'
        GS1-CBV-XML-Format:
          $ref: '#/components/headers/GS1-CBV-XML-Format'
        GS1-Extensions:
          $ref: '#/components/headers/GS1-Extensions'
        GS1-Vendor-Version:
          $ref: '#/components/headers/GS1-Vendor-Version'
        GS1-EPCIS-Capture-Limit:
          $ref: '#/components/headers/GS1-EPCIS-Capture-Limit'
        GS1-EPCIS-Capture-File-Size-Limit:
          $ref: '#/components/headers/GS1-EPCIS-Capture-File-Size-Limit'
        GS1-Capture-Error-Behaviour:
          $ref: '#/components/headers/GS1-Capture-Error-Behaviour'
    204SubscriptionEndpointDiscovery:
      description: |
        The `OPTIONS` method returns information describing individual query subscriptions.
        The list of headers is not exhaustive. It only describes the functionality specific to EPCIS 2.0.
      headers:
        Allow:
          description: Lists the set of methods supported by the resource. 
          schema:
            example: OPTIONS, DELETE, GET
            type: string
            default: OPTIONS, DELETE, GET
        GS1-EPCIS-Min:
          $ref: '#/components/headers/GS1-EPCIS-Min'
        GS1-EPCIS-Max:
          $ref: '#/components/headers/GS1-EPCIS-Max'
        GS1-CBV-Min:
          $ref: '#/components/headers/GS1-CBV-Min'
        GS1-CBV-Max:
          $ref: '#/components/headers/GS1-CBV-Max'
        GS1-EPC-Format:
          $ref: '#/components/headers/GS1-EPC-Format'
        GS1-CBV-XML-Format:
          $ref: '#/components/headers/GS1-CBV-XML-Format'
        GS1-Extensions:
          $ref: '#/components/headers/GS1-Extensions'
        GS1-Vendor-Version:
          $ref: '#/components/headers/GS1-Vendor-Version'
        GS1-Query-Min-Record-Time:
          $ref: '#/components/headers/GS1-Query-Min-Record-Time'

    204QueryDeleted:
      description: Query deleted and clients disconnected.
    400SubscriptionIssues:
      description: An issue with a subscription occurred.
      content:
        application/json:
          schema:
            example:
              type: "epcisException:SubscriptionControlsException"
              title: "Subscription error"
              status: 400
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 400
                    default: 400
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:SubscriptionControlsException
                      - epcisException:ValidationException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
    400QueryIssues:
      description: Query exceptions defined in EPCIS.
      content:
        application/problem+json:
          schema:
            example:
              type: "epcisException:QueryValidationException"
              title: "EPCIS query exception"
              status: 400
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 400
                    default: 400
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:QueryValidationException
                      - epcisException:QueryParameterException
                      - epcisException:ValidationException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
    401UnauthorizedRequest:
      description: Authorization information is missing or invalid.
      content:
        application/problem+json:
          schema:
            example:
              type: "epcisException:SecurityException"
              title: "Unauthorised request"
              status: 401
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 401
                    default: 401
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:SecurityException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
    403ClientUnauthorized:
      description: Client is unauthorized to access this resource.
      content:
        application/problem+json:
          schema:
            example:
              type: "epcisException:SecurityException"
              title: "Access to resource forbidden"
              status: 403
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 403
                    default: 403
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:SecurityException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
    404ResourceNotFound:
      description: The resource was not found. For example, the EPCIS event does not exist or the query does not exist.
      content:
        application/problem+json:
          schema:
            example:
              type: "epcisException:NoSuchNameException"
              title: "Resource not found"
              status: 404
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 404
                    default: 404
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:NoSuchNameException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
    413CapturePayloadTooLarge:
      headers:
        GS1-EPCIS-Capture-Limit:
          $ref: '#/components/headers/GS1-EPCIS-Capture-Limit'
        GS1-EPCIS-Capture-File-Size-Limit:
          $ref: '#/components/headers/GS1-EPCIS-Capture-File-Size-Limit'
      description: |
        The `POST` request is too large. It exceeds the limits set in `GS1-EPCIS-Capture-Limit` and/or
        `GS1-EPCIS-Capture-File-Size-Limit`.
      content:
        application/problem+json:
          schema:
            example:
              type: "epcisException:CaptureLimitExceededException"
              title: "Capture Payload too large"
              status: 413
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 413
                    default: 413
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:CaptureLimitExceededException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
    413QueryScopeOrSize:
      description: Query result is too large.
      content:
        application/problem+json:
          schema:
            example:
              type: "epcisException:QueryTooComplexException"
              title: "Capture Payload too large"
              status: 413
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 413
                    default: 413
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:QueryTooLargeException
                      - epcisException:QueryTooComplexException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
    414URLTooLong:
      description: URL is too long. This is usually a problem with large EPCIS queries in the URL.
      content:
        application/problem+json:
          schema:
            example:
              type: "epcisException:URITooLongException"
              title: "URI Too Long"
              status: 414
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 414
                    default: 414
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:URITooLongException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
    406NotAcceptable:
      description: |
        The server cannot return the response as requested. For example, the client requested an HTML response
        but the server does not support this.
      content:
        application/problem+json:
          schema:
            example:
              type: "epcisException:ImplementationException"
              title: "Cannot reproduce response in a desired content type"
              status: 406
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 406
                    default: 406
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:ImplementationException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
    415UnsupportedMediaType:
      description: |
        The client sent data in a format that is not supported by the server.
      content:
        application/problem+json:
          schema:
            example:
              type: "epcisException:ImplementationException"
              title: "Unsupported Media Type"
              status: 415
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 415
                    default: 415
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:ImplementationException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
    500ImplementationException:
      description: An error occurred on the backend.
      content:
        application/problem+json:
          schema:
            example:
              type: "epcisException:ImplementationException"
              title: "A server-side error occurred"
              status: 500
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 500
                    default: 500
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:ImplementationException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
    501NotImplemented:
      description: Functionality not supported by server.
      content:
        application/problem+json:
          schema:
            example:
              type: "epcisException:ImplementationException"
              title: "Functionality not supported by server"
              status: 501
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 501
                    default: 501
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:ImplementationException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'

  schemas:
    LDContext:
      description: JSON-LD @context. 
      anyOf:
        - type: array
          items:
              anyOf:
              - type: string
                format: uri
              - type: object
        - type: string 
          format: uri
        - type: object
    Location:
      description: Location header of a resource.
      type: string
      format: uri
      example: /eventTypes/ObjectEvent/events/eventId123
    RFC7807ProblemResponseBody:
      description: A response as specified in [RFC 7807](https://tools.ietf.org/html/rfc7807).
      type: object
      required:
        - type
        - title
      properties:
        type:
          type: string
          format: uri
        title:
          type: string
        status:
          type: integer
        detail:
          type: string
        instance:
          type: string
          format: uri

    QueryDefinition:
      example:
        { 
          "name" : "UniqueQueryName",
          "query": {
            "eventType": [ "ObjectEvent" ] ,
            "EQ_bizStep": [
                "shipping",
                "receiving" ]
          }
        }
      description: |
        Creating a new query with query body.
      type: object
      required:
        - name
        - query
      properties:
        name:
          type: string
        query:
          $ref: '#/components/schemas/EPCISEventsQuery'

    EPCISEventsQuery:
      type: object
      description: An EPCIS event query.
      example:
        {
          "eventType": ["ObjectEvent"],
          "EQ_bizStep": [
              "shipping",
              "receiving" ]
        }
      externalDocs:
        url: query-schema.json
      items:
        type: object
    subscriptionID:
      description: The ID of a WebHook subscription.
      example: df5a33e3-5aa3-4403-ae01-99b83234e27b
      type: string
    dest: 
      description: Callback URL to receive EPCIS resources and errors.
      type: string
      format: uri
      example: https://client.example.com/queryCallback
    QueryName:
      description: Unique query name.
      type: string
      example: myQuery
    SingleEvent:
      description: |
        A single EPCIS event. The full schema is specified in the JSON-Schema documentation.
      type: object
      required:
        - 'type'
      properties:
        '@context':
          type: array
          items:
            anyOf:
              - type: string
                format: uri
              - type: object
        'type':
          type: string
          example: ObjectEvent
      externalDocs:
        description: |
          A SingleEvent that must be validated with the external JSON Schema.
        url: ../JSON/EPCIS-JSON-Schema.json
      example:
        {
          "@context": "https://gs1.github.io/EPCIS/epcis-context.jsonld",
          "type": "ObjectEvent",
          "action": "OBSERVE",
          "bizStep": "inspecting",
          "eventTime": "2021-05-05T15:00:00.000+01:00",
          "eventTimeZoneOffset": "+01:00",
          "readPoint": {
            "id": "urn:epc:id:sgln:4012345.00005.0"
          },
          "epcList": [
              "urn:epc:id:sgtin:4012345.011111.9876"
          ],
          "sensorElementList": [
            {
              "sensorMetadata": {
                "time": "2019-04-02T14:05:00.000+01:00",
                "deviceID": "urn:epc:id:giai:4000001.111",
                "deviceMetadata": "https://id.gs1.org/8004/4000001111",
                "rawData": "https://example.org/8004/401234599999"
              },
              "sensorReport": [
                {
                  "type": "gs1:Temperature",
                  "value": 26.0,
                  "uom": "CEL"
                },
                {
                  "type": "gs1:AbsoluteHumidity",
                  "value": 12.1,
                  "uom": "A93"
                },
                {
                  "type": "gs1:Speed",
                  "value": 160.0,
                  "uom": "KMH"
                },
                {
                  "type": "gs1:Illuminance",
                  "value": 800.0,
                  "uom": "LUX"
                }
              ]
            },
            {
              "sensorMetadata": {
                "time": "2019-04-02T14:35:00.000+01:00",
                "deviceID": "urn:epc:id:giai:4000001.111",
                "deviceMetadata": "https://id.gs1.org/8004/4000001111",
                "rawData": "https://example.org/8004/401234599999"
              },
              "sensorReport": [
                {
                  "type": "gs1:Temperature",
                  "value": 26.1,
                  "uom": "CEL"
                },
                {
                  "type": "gs1:AbsoluteHumidity",
                  "value": 12.2,
                  "uom": "A93"
                },
                {
                  "type": "gs1:Speed",
                  "value": 161.0,
                  "uom": "KMH"
                },
                {
                  "type": "gs1:Illuminance",
                  "value": 801.0,
                  "uom": "LUX"
                }
              ]
            },
            {
              "sensorMetadata": {
                "time": "2019-04-02T14:55:00.000+01:00",
                "deviceID": "urn:epc:id:giai:4000001.111",
                "deviceMetadata": "https://id.gs1.org/8004/4000001111",
                "rawData": "https://example.org/8004/401234599999"
              },
              "sensorReport": [
                {
                  "type": "gs1:Temperature",
                  "value": 26.2,
                  "uom": "CEL"
                },
                {
                  "type": "gs1:AbsoluteHumidity",
                  "value": 12.2,
                  "uom": "A93"
                },
                {
                  "type": "gs1:Speed",
                  "value": 162.0,
                  "uom": "KMH"
                },
                {
                  "type": "gs1:Illuminance",
                  "value": 802.0,
                  "uom": "LUX"
                }
              ]
            }
          ]
        }
    EPCISDocument:
      description: A collection of EPCIS resources.
      type: object
      required:
        - '@context'
        - schemaVersion
        - creationDate
        - 'type'
        - epcisBody
      properties:
        '@context':
          type: array
          items:
            anyOf:
              - type: string
                format: uri
              - type: object
        'type':
          type: string
          enum: 
            - EPCISDocument
          example: EPCISDocument
        schemaVersion:
          type: number
        creationDate:
          type: string
          format: date-time
        format:
          type: string
          example: "application/ld+json"
        epcisBody:
          type: object
          properties:
            eventList:
              type: array
              uniqueItems: true
              items:
                type: object
          required:
            - eventList
        epcisHeader:
          type: object
          properties:
            epcisMasterData:
              type: object
              properties:
                vocabularyList:
                  type: array
                  uniqueItems: true
                  items:
                    type: object

      example:
        {
          "@context": [
              "https://gs1.github.io/EPCIS/epcis-context.jsonld",
              { "example": "http://ns.example.com/epcis/" } ],
          "type": "EPCISDocument",
          "schemaVersion": 2.0,
          "creationDate": "2021-07-11T11:30:47.0Z",
          "epcisBody": {
            "eventList": [
              {
                "eventID": "_:event1",
                "type": "ObjectEvent",
                "action": "OBSERVE",
                "bizStep": "shipping",
                "disposition": "in_transit",
                "epcList": [ "urn:epc:id:sgtin:0614141.107346.2017","urn:epc:id:sgtin:0614141.107346.2018" ],
                "eventTime": "2022-01-08T20:33:31.116-06:00",
                "eventTimeZoneOffset": "-06:00",
                "readPoint": { "id": "urn:epc:id:sgln:0614141.07346.1234" },
                "bizTransactionList": [
                  { "type": "po", "bizTransaction": "http://transaction.acme.com/po/12345678" } ]
              },
              {
                "eventID": "_:event2",
                "type": "ObjectEvent",
                "action": "OBSERVE",
                "bizStep": "receiving",
                "disposition": "in_progress",
                "epcList": [ "urn:epc:id:sgtin:0614141.107346.2018" ],
                "eventTime": "2022-01-08T20:33:32.116-06:00",
                "eventTimeZoneOffset": "-06:00",
                "readPoint": { "id": "urn:epc:id:sgln:0012345.11111.400" },
                "bizLocation": { "id": "urn:epc:id:sgln:0012345.11111.0" },
                "bizTransactionList": [
                  { "type": "po", "bizTransaction": "http://transaction.acme.com/po/12345678" },
                  { "type": "desadv", "bizTransaction": "urn:epcglobal:cbv:bt:0614141073467:1152" }
                ],
                "example:myField": "Example of a vendor/user extension"
              }
            ]
          }
        }
      externalDocs:
        description: |
          An EPCIS document that must be validated with the [JSON schema](../JSON/EPCIS-JSON-Schema.json) or
          [SHACL file](../JSON/EPCIS-SHACL.ttl).
        url: ../JSON/EPCIS-SHACL.ttl
    CaptureJob:
      description: |
        When EPCIS events are added through the capture interface, the capture process can run asynchronously. If the payload
        is syntactically correct and the client is allowed to call `/capture`, the server returns a `202`. This
        does not guarantee successful storage of all EPCIS events. The capture job endpoint exposes the state
        of the capture job to the client.

        A capture job document has at least the following properties:

        - `running`: whether or not the capture job is still active
        - `success`: whether or not at least one error occurred,
        - `errors` or `errorFile`: with the errors if `success` is `false`.

      example: {
        "captureID": "id9261379075",
        "createdAt": "2021-08-21T17:32:28Z",
        "running": true,
        "success": true,
        "errors": [ ]
      }
      type: object
      allOf:
        - properties:
            captureID:
              example: id9261379075
              description: A unique value identifying a capture job generated by the server.
              type: string
            running:
              description: |
                If the job is still running, the state is `true`, otherwise `false`.
              type: boolean
              example: true
            success:
              description: |
                If `success` is `false`, there was at least one error. Otherwise, `success` is `true`.
                If the `GS1-Capture-Error-Behaviour` header is `rollback`, `success` being `false` aborts the capture
                job and rejects all EPCIS events related to the job.
                If `GS1-Capture-Error-Behaviour` header is `proceed`, some EPCIS events might still be captured, even
                if `success` is `false`.
              type: boolean
              example: false
            createdAt:
              description: "When the capture job started"
              example: "2021-08-21T17:32:28Z"
              type: string
              format: date-time
        - oneOf:
            - properties:
                errors:
                  description: |
                    If the job was successful, the array is empty.
                  default: []
                  example: []
                  type: array
                  items:
                    $ref: '#/components/schemas/RFC7807ProblemResponseBody'
            - properties:
                errorFile:
                  description: |
                    Instead of returning errors in the `errors` property, the server can also write errors to a logfile,
                    and shere the URL with the client.
                  example: ''
                  type: string
                  format: uri
    EPCISQueryDocument:
      description: A collection of EPCIS resources.
      type: object
      required:
        - '@context'
        - 'type'
        - epcisBody
      properties:
        '@context':
          type: array
          items:
            uniqueItems: true
            anyOf:
              - type: string
                format: uri
              - type: object
        'type':
          type: string
          enum: 
            - EPCISQueryDocument
          example: EPCISQueryDocument
        schemaVersion:
          type: string
          pattern: ^\d+(\.\d+)?$
          example: "2.0"
        creationDate:
          type: string
          format: date-time
        epcisBody:
          type: object
          properties:
            queryResults:
              type: object
              properties:
                queryName:
                  $ref: '#/components/schemas/QueryName'
                subscriptionID:
                  $ref: '#/components/schemas/subscriptionID'
                resultsBody:
                  type: object
                  required:
                    - eventList
                  properties:
                    eventList:
                      type: array
                      items:
                        type: object
        epcisHeader:
          type: object
          properties:
            epcisMasterData:
              type: object
              properties:
                vocabularyList:
                  type: array
                  uniqueItems: true
                  items:
                    type: object

      example:
        {
          "@context": [
              "https://gs1.github.io/EPCIS/epcis-context.jsonld",
            {
              "example": "http://ns.example.com/epcis/"
            }
          ],
          "type": "EPCISQueryDocument",
          "schemaVersion": 2.0,
          "creationDate": "2021-07-11T11:30:47.0Z",
          "epcisBody": {
            "queryResults": {
              "resultsBody": {
                "eventList": [
                  {
                    "eventID": "_:event1",
                    "type": "ObjectEvent",
                    "action": "OBSERVE",
                    "bizStep": "shipping",
                    "disposition": "in_transit",
                    "epcList": [
                        "urn:epc:id:sgtin:0614141.107346.2017",
                        "urn:epc:id:sgtin:0614141.107346.2018"
                    ],
                    "eventTime": "2021-04-03T20:33:31.116000-06:00",
                    "eventTimeZoneOffset": "-06:00",
                    "readPoint": {
                      "id": "urn:epc:id:sgln:0614141.07346.1234"
                    },
                    "bizTransactionList": [
                      {
                        "type": "po",
                        "bizTransaction": "http://transaction.acme.com/po/12345678"
                      }
                    ]
                  },
                  {
                    "eventID": "_:event2",
                    "type": "ObjectEvent",
                    "action": "OBSERVE",
                    "bizStep": "receiving",
                    "disposition": "in_progress",
                    "epcList": [
                        "urn:epc:id:sgtin:0614141.107346.2018"
                    ],
                    "eventTime": "2021-04-04T20:33:31.116-06:00",
                    "eventTimeZoneOffset": "-06:00",
                    "readPoint": {
                      "id": "urn:epc:id:sgln:0012345.11111.400"
                    },
                    "bizLocation": {
                      "id": "urn:epc:id:sgln:0012345.11111.0"
                    },
                    "bizTransactionList": [
                      {
                        "type": "po",
                        "bizTransaction": "http://transaction.acme.com/po/12345678"
                      },
                      {
                        "type": "desadv",
                        "bizTransaction": "urn:epcglobal:cbv:bt:0614141073467:1152"
                      }
                    ],
                    "example:myField": "Example of a vendor/user extension"
                  }
                ]
              }
            }
          }
        }
      externalDocs:
        description: |
          An EPCIS document that must be validated with the [JSON schema](../JSON/EPCIS-JSON-Schema.json) or
          [SHACL file](../JSON/EPCIS-SHACL.ttl).
        url: ../JSON/EPCIS-SHACL.ttl
    Link:
      description: |
        A pagination header link. This header works together with the `perPage` and `nextPageToken` query string
        parameters.
      type: string
      format: uri
      example: 
        '<https://example.com/epcis/events?perPage=30&nextPageToken=3A15506738749783AU6D7DENAKwM2gQRRwGrataeq>; rel="next"'
        
    PerPage:
      description: |
        This parameter helps to control the amount of data returned to the client through pagination.
        In the case of EPCIS events, `perPage` specifies the maximum number of events in a response to the client.
        It does not mandate that the server reaches this limit. For example, if the server sees that some EPCIS events are very
        large, the server can decide to return fewer events to avoid creating an error because the response body is too
        large.

        As long as there are more resources to retrieve, the `Link` header contains the URL of the next page and
        the attribute `rel="next"`. The last page is indicated by the absence of the `rel="next"`. Depending on the
        implementation, there can be a global upper limit for the `perPage` value that the client cannot override,
        which should be stated in the documentation.
      type: integer
      default: 30
    NextPageToken:
      description: |
        Parameter that points to the next list of results when requesting a list of events that is larger than the value
        specified with the `perPage` parameter. Some technologies refer to this as scrolling.
        A `nextPageToken` may be invalidated through timeout. It is up to the specific implementation to provide
        the mechanisms for invalidating tokens.
      type: string
      example: '3A15506738749783AU6D7DENAKwM2gQRRwGrataeq'
    Upgrade:
      type: string
      description: The `Upgrade` and `Connection` headers are needed to open a Websocket for queries.
      default: websocket
      example: websocket
    Connection:
      example: Upgrade
      description: The `Upgrade` and `Connection` headers are needed to open a Websocket for queries.
      type: string
      default: upgrade
    EventTypeItemList:
      type: object
      description: Event type item list
      example: {
        "@context": "https://gs1.github.io/EPCIS/epcis-context.jsonld",
        "type": "EventTypeItemList",
        "eventType": ["ObjectEvent", "AssociationEvent"]
      }
      required: 
        - '@context'
        - 'type'
        - eventType
      properties:
        '@context':
          $ref: '#/components/schemas/LDContext'
        'type':
          type: string
          enum: 
            - EventTypeItemList
        eventType:
          type: array
          items:
            anyOf:
              - $ref: '#/components/schemas/EPCISEventTypes'
              - type: string
                format: uri
          uniqueItems: true
    EPCISEventTypes:
      type: string
      description: The five types of EPCIS events.
      example:
        - ObjectEvent
        - AggregationEvent
        - AssociationEvent
        - TransformationEvent
        - TransactionEvent
      enum:
        - ObjectEvent
        - AggregationEvent
        - AssociationEvent
        - TransformationEvent
        - TransactionEvent
    TopLevelResources:
      type: string
      description: The seven top level resources of an EPCIS.
      example:
        - events
        - eventTypes
        - epcs
        - bizSteps
        - bizLocations
        - readPoints
        - dispositions
        - capture
        - queries
      enum:
        - events
        - eventTypes
        - epcs
        - bizSteps
        - bizLocations
        - readPoints
        - dispositions
        - capture
        - queries
    BizStepItemList:
      example: {
        "@context": [
          "https://gs1.github.io/EPCIS/epcis-context.jsonld",
          {
            "ex": "https://example.org/my-steps/"
          }
        ],
        "type": "BizStepItemList",
        "bizStep": ["receiving", "shipping", "ex:funding"]
      }
      type: object
      required:
        - '@context'
        - 'type'
        - bizStep
      properties:
        '@context':
          $ref: '#/components/schemas/LDContext'
        'type':
          type: string
          enum: 
            - 'BizStepItemList'
        bizStep:
          type: array
          items:
            type: string
          uniqueItems: true
    DispositionItemList:
      example: {
        "@context": "https://gs1.github.io/EPCIS/epcis-context.jsonld",
        "type": "DispositionItemList",
        "disposition": ["inline", "active"]
      }
      type: object
      required:
        - '@context'
        - 'type'
        - disposition
      properties:
        '@context':
          $ref: '#/components/schemas/LDContext'
        'type':
          type: string
          enum: 
            - 'DispositionItemList'
        disposition:
          type: array
          items:
            type: string
          uniqueItems: true
    BizLocationItemList:
      example: {
        "@context": "https://gs1.github.io/EPCIS/epcis-context.jsonld",
        "type": "BizLocationItemList",
        "bizLocation": ["urn:epc:id:sgln:9524987.20000.0"]
      }
      type: object
      required:
        - '@context'
        - 'type'
        - bizLocation
      properties:
        '@context':
          $ref: '#/components/schemas/LDContext'
        'type':
          type: string
          enum: 
            - 'BizLocationItemList'
        bizLocation:
          type: array
          items:
            type: string
            format: uri
          uniqueItems: true
    ReadPointItemList:
      example: {
        "@context": "https://gs1.github.io/EPCIS/epcis-context.jsonld",
        "type": "ReadPointItemList",
        "readPoint": [
          "urn:epc:id:sgln:9524678.90000.WarehouseD2",
          "urn:epc:id:sgln:9524678.90000.WarehouseD1"
        ]
      }
      type: object
      required:
        - '@context'
        - 'type'
        - readPoint
      properties:
        '@context':
          $ref: '#/components/schemas/LDContext'
        'type':
          type: string
          enum: 
            - 'ReadPointItemList'
        readPoint:
          type: array
          items:
            type: string
            format: uri
          uniqueItems: true
    AbstractQuerySubscription:
      example: {
        "dest": "https://client.example.com/queryCallback",
        "secret": "0435ojtojt02"
      }
      type: object
      description: |
        This schema contains shared features of EPCIS query subscriptions. If the schema is used in a response, the
        `secret` should not be fully revealed.
      required:
        - dest
        - secret
      properties:
        dest:
          $ref: '#/components/schemas/dest'
        secret:
          example: '0435ojtojt02'
          type: string
          description: Secret generated by the client for the server.
        initialRecordTime:
          $ref: '#/components/schemas/GS1-Query-InitialRecordTime'
    
    AbstractQuerySubscriptionResponse:
      example: {
        "dest": "https://client.example.com/queryCallback",
        "subscriptionID" : "df5a33e3-5aa3-4403-ae01-99b83234e27b",
        "stream": true,
        "createdAt": "2017-08-21T17:32:28Z"
      }
      type: object
      description: |
        This schema contains shared features of EPCIS query subscriptions response.
      required:
        - dest
        - subscriptionID
        - createdAt
      properties:
        dest:
          $ref: '#/components/schemas/dest'
        subscriptionID:
          $ref: '#/components/schemas/subscriptionID'
        createdAt:
          example: "2017-08-21T17:32:28Z"
          type: string
          format: date-time
        initialRecordTime:
          $ref: '#/components/schemas/GS1-Query-InitialRecordTime'
        minRecordTime:
          $ref: '#/components/schemas/GS1-Query-Min-Record-Time'

    QueryStreamSubscription:
      description: |
        If no query schedule is specified, the client must explicitly set `stream` to `true`. This restriction is to
        prevent clients from accidentally subscribing to EPCIS event streams.

        Example:

        ```
        POST /queries/MyQuery/subscriptions
        {
          "dest": "https://client.example.com/queryCallback",
          "secret": "0435ojtojt02",
          "stream": true
        }
        ```
      type: object
      example: { "stream":true }
      required:
        - stream
      properties:
        stream:
          $ref: '#/components/schemas/GS1-Query-Stream'

    QueryScheduleSubscription:
      description: |
        A scheduled query subscription is a time-based query execution scheduler. EPCIS 2.0 scheduled queries are scheduled
        in the same manner as cron jobs.

        For example, this query subscription is scheduled to trigger every morning at 1.05am. By setting
        `reportIfEmpty` to `true`, the client's callback URL will be called even if there are no new events that match
        the query.

        ```
        POST /queries/MyQuery/subscriptions
        {
          "dest": "https://client.example.com/queryCallback",
          "secret": "0435ojtojt02",
          "reportIfEmpty": true,
          "schedule": {
            "hour":"1",
            "minute": "5"
          }
        }
        ```
      type: object
      example: { "schedule": {"hour":"1", "minute": "5"} }
      required:
        - schedule
      properties:
        reportIfEmpty:
          $ref: '#/components/schemas/GS1-Query-ReportIfEmpty'
        schedule:
          type: object
          properties:
            second:
              $ref: '#/components/schemas/GS1-Query-Second'
            minute:
              $ref: '#/components/schemas/GS1-Query-Minute'
            hour:
              $ref: '#/components/schemas/GS1-Query-Hour'
            dayOfMonth:
              $ref: '#/components/schemas/GS1-Query-DayOfMonth'
            month:
              $ref: '#/components/schemas/GS1-Query-Month'
            dayOfWeek:
              $ref: '#/components/schemas/GS1-Query-DayOfWeek'
    GS1-Query-InitialRecordTime:
      description: |
        Used to specify a time to constrain what resources are considered when processing a query
        subscription. This value only applies the first time a subscriber receives events. If omitted, the default
        value is the current time.
      type: string
      format: date-time
      example: "2020-04-04T20:33:31.116-06:00"
    GS1-Query-Min-Record-Time:
      example: "2020-04-04T20:33:31.116-06:00"
      description: |
       Used to specify the smallest possible record time for EPCIS events in an outstanding query subscription.
      type: string
      format: date-time
    GS1-Query-ReportIfEmpty:
      example: false
      type: boolean
      default: false
      description: Flag to specify subscribed clients should be notified if the query result is empty.
    GS1-Query-Second:
      description: |
        Specifies that the query time must have a matching seconds value. The range for this parameter is 0
        through 59, inclusive.
      example: 0
      type: string
      pattern: "(\\g<element>,)*\\g<element>|(?<element>(\\g<number>|\\g<range>))|(?<range>(\\[\\g<number>\\-\\g<number>\\]))|(?<number>([0-59]))"
    GS1-Query-Minute:
      description: |
        Specifies that the query time must have a matching minute value. The range for this parameter is 0 through 59,
        inclusive.
      example: 5
      type: string
      pattern: "(\\g<element>,)*\\g<element>|(?<element>(\\g<number>|\\g<range>))|(?<range>(\\[\\g<number>\\-\\g<number>\\]))|(?<number>([0-59]))"
    GS1-Query-Hour:
      description: |
        Specifies that the query time must have a matching hour value. The range for this parameter is 0 through 23,
        inclusive, with 0 denoting the hour that begins at midnight, and 23 denoting the hour that ends at midnight.
      example: 1
      type: string
      pattern: "(\\g<element>,)*\\g<element>|(?<element>(\\g<number>|\\g<range>))|(?<range>(\\[\\g<number>\\-\\g<number>\\]))|(?<number>([0-23]))"
    GS1-Query-DayOfMonth:
      description: |
        Specifies that the query time must have a matching day of month value. The range for this parameter is 1 through
        31, inclusive.
      example: 1
      type: string
      pattern: "(\\g<element>,)*\\g<element>|(?<element>(\\g<number>|\\g<range>))|(?<range>(\\[\\g<number>\\-\\g<number>\\]))|(?<number>([1-31]))"
    GS1-Query-Month:
      description: |
        Specifies that the query time must have a matching month value. The range for this parameter is 1 through 12,
        inclusive.
      example: 1
      type: string
      pattern: "(\\g<element>,)*\\g<element>|(?<element>(\\g<number>|\\g<range>))|(?<range>(\\[\\g<number>\\-\\g<number>\\]))|(?<number>([1-12]))"
    GS1-Query-DayOfWeek:
      description: |
        Specifies that the query time must have a matching day of week value. The range for this parameter is 1 through
        7, inclusive, with 1 denoting Monday, 2 denoting Tuesday, and so forth, up to 7 denoting Sunday.
      example: 1
      type: string
      pattern: "(\\g<element>,)*\\g<element>|(?<element>(\\g<number>|\\g<range>))|(?<range>(\\[\\g<number>\\-\\g<number>\\]))|(?<number>([1-7]))"
    GS1-Query-Stream:
      type: boolean
      description: |
        If no schedule is specified and `stream` is `true`, the standing subscription SHALL report immediately whenever a
        captured EPCIS event matches the query criteria.
      default: true
      enum:
        - true


    # describe header schema
    version:
      type: string
      pattern: ^\d+(\.\d+)?$
      
    GS1-EPCIS-Version:
      allOf: 
        - example: "2.0"
        - $ref: '#/components/schemas/version'
    GS1-EPCIS-Min:
      allOf: 
        - example: "1.0"
        - $ref: '#/components/schemas/version'
    GS1-EPCIS-Max:
      allOf:
        - example: "2.0"
        - $ref: '#/components/schemas/version'

    GS1-CBV-Version:
      allOf:
        - example: "2.0"
        - $ref: '#/components/schemas/version'
    GS1-CBV-Min:
      allOf:
        - example: "1.2"
        - $ref: '#/components/schemas/version'
    GS1-CBV-Max:
      allOf:
        - example: "2.0"
        - $ref: '#/components/schemas/version'

    GS1-EPC-Format:
      example: Always_GS1_Digital_Link
      type: string
      enum:
        - No_Preference
        - Always_GS1_Digital_Link
        - Always_EPC_URN
        - Never_Translates
    GS1-CBV-XML-Format:
      example: Always_Web_URI
      type: string
      enum:
        - No_Preference
        - Always_Web_URI
        - Always_URN
        - Never_Translates
    GS1-Extensions:
      example: {"example-epc-ext": "http://example.com/epcis/"}
      type: object
    GS1-Vendor-Version:
      example: example-version-1.0
      anyOf:
        - type: string
        - type: object
    GS1-EPCIS-Capture-Limit:
      example: 500
      type: string
      pattern: ^(\d+|\*)$
    GS1-EPCIS-Capture-File-Size-Limit:
      example: 1024
      type: string
      pattern: ^(\d+|\*)$
    GS1-Capture-Error-Behaviour:
      example: 'rollback'
      type: string
      default: 'rollback'
      enum:
        - 'rollback'
        - 'proceed'
    GS1-Next-Page-Token-Expires:
      example: '2017-07-21T17:32:28Z'
      type: string
      format: date-time

  parameters:
    # Top-level resource instances
    EPC:
      description: An electronic product code value.
      example: urn:epc:id:sgtin:0614141.107346.2018
      required: true
      in: path
      name: epc
      schema:
        type: string
        format: uri
    BizStep:
      description: A business step value.
      example: urn:epcglobal:cbv:bizstep:receiving
      required: true
      in: path
      name: bizStep
      schema:
        type: string
        format: uri
    BizLocation:
      description: A business location value.
      example: urn:epc:id:sgln:0012345.11111.0
      required: true
      in: path
      name: bizLocation
      schema:
        type: string
        format: uri
    ReadPoint:
      description: A read point value.
      example: urn:epc:id:sgln:0012345.11111.400
      required: true
      in: path
      name: readPoint
      schema:
        type: string
        format: uri
    Disposition:
      description: A disposition value.
      example: in_progress
      required: true
      in: path
      name: disposition
      schema:
        type: string
        format: uri
    EventID:
      name: eventID
      in: path
      description: |
        The ID of an EPCIS event. An EPCIS event ID must be unique across all events in the system.
      required: true
      example: "ni:///sha-256;df7bb3c352fef055578554f09f5e2aa41782150ced7bd0b8af24dd3ccb30ba69?ver=CBV2.0"
      schema:
        type: string
        format: uri
    EventType:
      name: eventType
      in: path
      example: ObjectEvent
      required: true
      description: |
        Names of EPCIS event types.
      schema:
        oneOf:
          - $ref: '#/components/schemas/EPCISEventTypes'
    QueryName:
      in: path
      name: queryName
      description: The name of an EPCIS event query.
      required: true
      schema:
        $ref: '#/components/schemas/QueryName'
    Token:
      in: path
      name: token
      required: true
      schema:
        $ref: '#/components/schemas/NextPageToken'
    PerPage:
      in: query
      name: perPage
      schema:
        $ref: '#/components/schemas/PerPage'
    NextPageToken:
      in: query
      name: nextPageToken
      schema:
        $ref: '#/components/schemas/NextPageToken'
    Upgrade:
      in: header
      name: Upgrade
      required: false
      schema:
        $ref: '#/components/schemas/Upgrade'
    Connection:
      in: header
      name: Connection
      required: false
      schema:
        $ref: '#/components/schemas/Connection'
    GS1-Query-Second:
      in: query
      name: second
      required: false
      schema:
        $ref: '#/components/schemas/GS1-Query-Second'
    GS1-Query-Minute:
      in: query
      name: minute
      required: false
      schema:
        $ref: '#/components/schemas/GS1-Query-Minute'
    GS1-Query-Hour:
      in: query
      name: hour
      required: false
      schema:
        $ref: '#/components/schemas/GS1-Query-Hour'
    GS1-Query-DayOfMonth:
      in: query
      name: dayOfMonth
      required: false
      schema:
        $ref: '#/components/schemas/GS1-Query-DayOfMonth'
    GS1-Query-Month:
      in: query
      name: month
      required: false
      schema:
        $ref: '#/components/schemas/GS1-Query-Month'
    GS1-Query-DayOfWeek:
      in: query
      name: dayOfWeek
      required: false
      schema:
        $ref: '#/components/schemas/GS1-Query-DayOfWeek'
    GS1-Query-ReportIfEmpty:
      in: query
      name: reportIfEmpty
      required: false
      schema:
        $ref: '#/components/schemas/GS1-Query-ReportIfEmpty'
    GS1-Query-Stream:
      in: query
      name: stream
      schema:
        $ref: '#/components/schemas/GS1-Query-Stream'
    GS1-Query-InitialRecordTime:
      in: query
      name: initialRecordTime
      required: false
      schema:
        $ref: '#/components/schemas/GS1-Query-InitialRecordTime'
    # request headers from schema
    GS1-EPCIS-Version:
      in: header
      name: GS1-EPCIS-Version
      description: 
        $ref: '#/components/headers/GS1-EPCIS-Version/description'
      schema:
        $ref: '#/components/schemas/GS1-EPCIS-Version'
    GS1-EPCIS-Min:
      in: header
      name: GS1-EPCIS-Min
      description: 
        $ref: '#/components/headers/GS1-EPCIS-Min/description'
      schema:
        $ref: '#/components/schemas/GS1-EPCIS-Min'
    GS1-EPCIS-Max:
      in: header
      name: GS1-EPCIS-Max
      description: 
        $ref: '#/components/headers/GS1-EPCIS-Max/description'
      schema:
        $ref: '#/components/schemas/GS1-EPCIS-Max'
    GS1-CBV-Version:
      in: header
      name: GS1-CBV-Version
      description: 
        $ref: '#/components/headers/GS1-CBV-Version/description'
      schema:
        $ref: '#/components/schemas/GS1-CBV-Version'
    GS1-CBV-Min:
      in: header
      name: GS1-CBV-Min
      description: 
        $ref: '#/components/headers/GS1-CBV-Min/description'
      schema:
        $ref: '#/components/schemas/GS1-CBV-Min'
    GS1-CBV-Max:
      in: header
      name: GS1-CBV-Max
      description: 
        $ref: '#/components/headers/GS1-CBV-Max/description'
      schema:
        $ref: '#/components/schemas/GS1-CBV-Max'
    GS1-EPC-Format:
      in: header
      name: GS1-EPC-Format
      description: 
        $ref: '#/components/headers/GS1-EPC-Format/description'
      schema:
        $ref: '#/components/schemas/GS1-EPC-Format'
    GS1-CBV-XML-Format:
      in: header
      name: GS1-CBV-XML-Format
      description: 
        $ref: '#/components/headers/GS1-CBV-XML-Format/description'
      schema:
        $ref: '#/components/schemas/GS1-CBV-XML-Format'
    GS1-Extensions:
      in: header
      name: GS1-Extensions
      description: 
        $ref: '#/components/headers/GS1-Extensions/description'
      schema:
        $ref: '#/components/schemas/GS1-Extensions'
    GS1-Capture-Error-Behaviour:
      name: GS1-Capture-Error-Behaviour
      description: 
        $ref: '#/components/headers/GS1-Capture-Error-Behaviour/description'
      in: header
      required: false
      schema:
        $ref: '#/components/schemas/GS1-Capture-Error-Behaviour'

  headers:
    GS1-EPCIS-Version:
      description: The EPCIS version.
      schema:
        $ref: '#/components/schemas/GS1-EPCIS-Version'
    GS1-EPCIS-Min:
      description: The lowest EPCIS version supported.
      schema:
        $ref: '#/components/schemas/GS1-EPCIS-Min'
    GS1-EPCIS-Max:
      description: The highest EPCIS version supported.
      schema:
        $ref: '#/components/schemas/GS1-EPCIS-Max'
    GS1-CBV-Version:
      description: The Core Business Vocabulary version.
      schema:
        $ref: '#/components/schemas/GS1-CBV-Version'
    GS1-CBV-Min:
      description: The lowest Core Business Vocabulary version supported.
      schema:
        $ref: '#/components/schemas/GS1-CBV-Min'
    GS1-CBV-Max:
      description: The highest Core Business Vocabulary version supported.
      schema:
        $ref: '#/components/schemas/GS1-CBV-Max'
    GS1-EPC-Format:
      description: |
        Request or response header to indicate whether EPCs are expressed as GS1 Digital Link URIs or as EPC URNs.
        If both server and client set `GS1-EPC-Format` to `No_Preference`, the default value is `Always_GS1_Digital_Link`:

        - No_Preference: The server chooses the representation.
        - Always_DL: URIs are returned as GS1 Digital Link.
        - Always_EPC_URN: URIs are returned as URN.
        - Never_Translates: The original format is kept.
      schema:
        $ref: '#/components/schemas/GS1-EPC-Format'
    GS1-CBV-XML-Format:
      description: |
        When requesting XML content-type only, users can use this header to request
        receiving events with CBV values in either URN or Web URI format.
        This option is not available for JSON/JSON-LD.

        - No_Preference: The server chooses the representation.
        - Always_Web_URI: CBV values are returned as Web URI.
        - Always_URN: CBV values are returned as URNs.
        - Never_Translates: The original format is kept.
      schema:
        $ref: '#/components/schemas/GS1-CBV-XML-Format'
    GS1-Extensions:
      description: Specific EPCIS or CBV extensions supported (e.g., for FIT).
      schema:
        $ref: '#/components/schemas/GS1-Extensions'
    GS1-Vendor-Version:
      description: A versioning scheme that can be freely chosen by the vendor.
      schema:
        $ref: '#/components/schemas/GS1-Vendor-Version'
    GS1-EPCIS-Capture-Limit:
      description: The maximum number of EPCIS events that can be captured per call.
      schema:
        $ref: '#/components/schemas/GS1-EPCIS-Capture-Limit'
    GS1-Query-Min-Record-Time:
      description: Informs about the smallest possible record time for EPCIS events in an outstanding query subscription.
      schema:
        $ref: '#/components/schemas/GS1-Query-Min-Record-Time'
    GS1-EPCIS-Capture-File-Size-Limit:
      description: The maximum event document length in octets (8-bit bytes) for capture operations.
      schema:
        $ref: '#/components/schemas/GS1-EPCIS-Capture-File-Size-Limit'
    GS1-Capture-Error-Behaviour:
      description: |
        A header to control how the capture interface will behave in case of an error:

        - `rollback`: "All or nothing". Either the capture job is entirely successful or all EPCIS events are rejected.
        - `proceed`: "Greedy capture". The capture interface tries to capture as many EPCIS events as possible, even if there are errors.

        The default behaviour is `rollback`, as in EPCIS 1.2.
      schema:
        $ref: '#/components/schemas/GS1-Capture-Error-Behaviour'
    GS1-Next-Page-Token-Expires:
      description: The expiry time for `nextPageToken`.
      schema:
        $ref: '#/components/schemas/GS1-Next-Page-Token-Expires'
    Link:
      description: |
        A pagination header link. This header works together with the `perPage` and `nextPageToken` query string
        parameters.
        As long as there are more resources to retrieve, the `Link` header contains the URL of the next page and
        the attribute `rel="next"`. The last page is indicated by the absence of the `rel="next"`.
      schema:
        $ref: '#/components/schemas/Link'

  requestBodies:
    CreateQuery:
      description: Creates and executes new EPCIS events query.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/QueryDefinition'

